module "masters" {
  source                          = "./nodes"
  name_prefix                     = "master"
  nodes_count                     = "${var.k8s_master_nodes_count}"
  public_access                   = "${var.k8s_master_public_access}"
  private_access                  = "${var.k8s_master_private_access}"
  openstack_token                 = "${var.openstack_token}"
  openstack_tenant_id             = "${var.openstack_tenant_id}"
  openstack_domain_id             = "${var.openstack_domain_id}"
  openstack_auth_url              = "${var.openstack_auth_url}"
  security_group_id               = "${openstack_networking_secgroup_v2.full_access.id}"
  floating_ip_pool                = "${var.openstack_floating_ip_pool}"
  operating_system_image          = "${var.k8s_operating_system_image}"
  flavor                          = "${var.k8s_master_flavor}"
  ssh_deploy_key_name             = "${openstack_compute_keypair_v2.ssh_deploy_key.name}"
  scheduler_hints_group_id        = "${openstack_compute_servergroup_v2.controlplane.id}"
  private_network_id              = "${var.openstack_private_network_id}"
  internal_network_id             = "${openstack_networking_network_v2.internal.id}"
  internal_network_subnet_id      = "${openstack_networking_subnet_v2.internal.id}"
  internal_network_cidr           = "${var.openstack_internal_network_cidr}"
  k8s_pod_cidr                    = "${var.k8s_pod_cidr}"
  k8s_service_cidr                = "${var.k8s_service_cidr}"
  k8s_version                     = "${var.k8s_version}"
}

module "workers" {
  source                          = "./nodes"
  name_prefix                     = "worker"
  nodes_count                     = "${var.k8s_worker_nodes_count}"
  openstack_token                 = "${var.openstack_token}"
  openstack_tenant_id             = "${var.openstack_tenant_id}"
  openstack_domain_id             = "${var.openstack_domain_id}"
  openstack_auth_url              = "${var.openstack_auth_url}"
  security_group_id               = "${openstack_networking_secgroup_v2.full_access.id}"
  operating_system_image          = "${var.k8s_operating_system_image}"
  flavor                          = "${var.k8s_worker_flavor}"
  ssh_deploy_key_name             = "${openstack_compute_keypair_v2.ssh_deploy_key.name}"
  scheduler_hints_group_id        = "${openstack_compute_servergroup_v2.compute.id}"
  internal_network_id             = "${openstack_networking_network_v2.internal.id}"
  internal_network_subnet_id      = "${openstack_networking_subnet_v2.internal.id}"
  internal_network_cidr           = "${var.openstack_internal_network_cidr}"
  k8s_pod_cidr                    = "${var.k8s_pod_cidr}"
  k8s_service_cidr                = "${var.k8s_service_cidr}"
  k8s_version                     = "${var.k8s_version}"
}